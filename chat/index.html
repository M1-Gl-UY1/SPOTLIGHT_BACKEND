<!DOCTYPE html>
<html>
<head>
    <title>Chat WebSocket Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h2>Test Chat</h2>
<div id="messages">d</div>

<script type="text/javascript">
    var socket = new SockJS('http://localhost:8080/ws');
    var stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log('Connecté: ' + frame);

        // Je m'abonne à mes propres messages (Simulons que je suis "userA")
        stompClient.subscribe('/user/userA/queue/messages', function (msg) {
            var notification = JSON.parse(msg.body);
            document.getElementById("messages").innerHTML +=
                "<p>Reçu de " + notification.senderId + "</p>";
        });

        // Simuler l'envoi d'un message après 2 secondes
        setTimeout(function() {
            var chatMessage = {
                senderId: "userB",
                recipientId: "userA",
                content: "Hello from userB!",
                timestamp: new Date()
            };
            stompClient.send("/app/chat", {}, JSON.stringify(chatMessage));
        }, 2000);
    });
</script>
</body>
</html>